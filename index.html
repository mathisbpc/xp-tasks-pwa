<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0b1020" />
  <title>XP Tasks</title>

  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="icon" href="./assets/icon-192.png" />
  <link rel="apple-touch-icon" href="./assets/icon-192.png" />

  <link rel="stylesheet" href="./styles.css" />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>

<body>
  <!-- TOP BAR -->
  <header class="topbar">
    <button id="burgerBtn" class="iconBtn" aria-label="Menu">☰</button>
    <div class="topbar__title">
      <div class="h1">XP Tasks</div>
      <div class="h2">Suivi quotidien • XP • Santé • Niveaux</div>
    </div>
  </header>

  <!-- DRAWER -->
  <div id="drawerBackdrop" class="backdrop hidden"></div>
  <aside id="drawer" class="drawer hidden" aria-hidden="true">
    <div class="drawer__title">Menu</div>
    <button class="drawer__item" data-go="today">Aujourd’hui</button>
    <button class="drawer__item" data-go="stats">Stats</button>
    <button class="drawer__item" data-go="settings">Réglages</button>
  </aside>

  <!-- TABS -->
  <nav class="tabs">
    <button id="tabToday" class="tab active" data-go="today">Aujourd’hui</button>
    <button id="tabStats" class="tab" data-go="stats">Stats</button>
    <button id="tabSettings" class="tab" data-go="settings">Réglages</button>
  </nav>

  <main class="container">

    <!-- PAGE: TODAY -->
    <section id="pageToday" class="page">
      <section class="card">
        <div class="kpiGrid">
          <div>
            <div class="kpiLabel">XP du jour</div>
            <div class="kpiValue"><span id="xpValue">0</span> <span class="kpiUnit">XP</span></div>
          </div>
          <div>
            <div class="kpiLabel">Santé</div>
            <div class="kpiValue"><span id="healthValue">100</span><span class="kpiUnit"> /100</span></div>
          </div>
        </div>

        <div class="levelRow">
          <img id="levelImg" class="levelImg" src="./assets/lvl1_larve.png" alt="Niveau" />
          <div>
            <div class="kpiLabel">Niveau</div>
            <div class="levelLabel" id="levelLabel">Larve</div>
          </div>
        </div>

        <div class="pill" id="todayPill">Jour: —</div>

        <div class="btnRow">
          <button id="resetTodayBtn" class="btn ghost">Réinitialiser</button>
          <button id="saveDayBtn" class="btn primary">Enregistrer</button>
        </div>

        <div class="muted" id="autoSaveInfo">
          ✅ Auto-enregistrement à 4h si au moins 1 tâche est cochée.
        </div>
      </section>

      <section class="card">
        <div class="cardTitleRow">
          <div>
            <div class="cardTitle">Tâches du jour</div>
            <div class="muted">Coche → XP & Santé se mettent à jour direct.</div>
          </div>
        </div>

        <div class="pillRow">
          <div class="pill">Date</div>
          <div class="pill" id="editDatePill">—</div>
          <button id="prevDayBtn" class="btn tiny">◀</button>
          <button id="nextDayBtn" class="btn tiny">▶</button>
        </div>

        <div id="tasksList"></div>
      </section>
    </section>

    <!-- PAGE: STATS -->
    <section id="pageStats" class="page hidden">
      <section class="card">
        <div class="cardTitleRow">
          <div class="cardTitle">Graphique (XP + Santé)</div>
          <div class="muted" id="rangeLabel">7 jours</div>
        </div>

        <div class="btnRow">
          <button class="btn tiny" data-range="7">7 jours</button>
          <button class="btn tiny" data-range="30">30 jours</button>
          <button class="btn tiny" data-range="90">90 jours</button>
        </div>

        <div class="chartWrap">
          <canvas id="chartCanvas"></canvas>
        </div>
      </section>

      <section class="card">
        <div class="cardTitleRow">
          <div class="cardTitle">Historique détaillé</div>
          <button id="clearHistoryBtn" class="btn danger tiny">Effacer</button>
        </div>
        <div id="historyList"></div>
      </section>
    </section>

    <!-- PAGE: SETTINGS -->
    <section id="pageSettings" class="page hidden">
      <section class="card">
        <div class="cardTitle">Réglages</div>

        <div class="settingRow">
          <div>
            <div class="settingTitle">Heure de changement de journée</div>
            <div class="muted">Ex: 4h → à 03:00 tu es encore “sur la journée d’hier”.</div>
          </div>
          <input id="dayChangeHour" class="input" type="number" min="0" max="23" value="4" />
        </div>

        <div class="settingRow">
          <div>
            <div class="settingTitle">Forcer la mise à jour (cache)</div>
            <div class="muted">Désinstalle le SW + vide le cache puis recharge.</div>
          </div>
          <button id="hardRefreshBtn" class="btn tiny">Hard refresh</button>
        </div>

        <div class="settingRow">
          <div>
            <div class="settingTitle">Info</div>
            <div class="muted" id="versionInfo">Version: —</div>
          </div>
        </div>
      </section>
    </section>

  </main>

  <script src="./app.js"></script>
</body>
</html>